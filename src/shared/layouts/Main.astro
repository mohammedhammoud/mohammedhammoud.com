---
import { getRelativeLocaleUrl } from "astro:i18n";
import BaseHead from "@shared/components/BaseHead.astro";
import ProfileHeader from "@shared/components/ProfileHeader.astro";
import NavTabs from "@shared/components/NavTabs.astro";
import LanguageSwitcher from "@shared/components/LanguageSwitcher.astro";
import ThemeToggle from "@shared/components/ThemeToggle.astro";
import Footer from "@shared/components/Footer.astro";
import { siGithub } from "simple-icons";
import { useTranslations } from "@i18n/use-translations";
import { C } from "@/site.config";
import type { Locale, TabKey } from "@/site.config";

interface Props {
  title?: string;
  description: string;
  locale: Locale;
  localeUrls: Record<string, string>;
  activeTab?: TabKey;
  class?: string;
  centered?: boolean;
}

const {
  title,
  description,
  locale,
  localeUrls,
  activeTab,
  class: className,
  centered = false,
} = Astro.props;

const t = useTranslations(locale);

const tabs = C.TABS.map((tab) => ({
  label: t(`nav.${tab}` as const),
  href: getRelativeLocaleUrl(locale, C.SEGMENT_TRANSLATIONS[locale][tab]),
  testId: `nav-tab-${tab}`,
  active: activeTab === tab,
}));

const socialLinks = [
  {
    name: t("social.github"),
    url: C.SITE.social.github,
    icon: siGithub,
  },
  {
    name: t("social.linkedin"),
    url: C.SITE.social.linkedin,
    icon: {
      title: "LinkedIn",
      path: "M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z",
    },
  },
];
---

<!doctype html>
<html lang={locale}>
  <head>
    <BaseHead
      title={[title, t("site.title")].filter(Boolean).join(" - ")}
      description={description}
      locale={locale}
    />
  </head>
  <body
    class="bg-white font-serif text-gray-900 antialiased transition-colors dark:bg-gray-900 dark:text-gray-100"
  >
    <div
      class={`mx-auto max-w-3xl px-6 py-8${centered ? " flex min-h-screen flex-col justify-center" : ""}`}
    >
      <div class="mb-12 flex items-center justify-between">
        <ThemeToggle lang={locale} />
        <LanguageSwitcher locale={locale} localeUrls={localeUrls} />
      </div>

      <div class="space-y-12">
        <ProfileHeader
          name={t("profile.name")}
          bio={t("profile.bio")}
          imageSrc={`https://avatars.githubusercontent.com/u/${C.SITE.githubUserId}?s=256`}
          socialLinks={socialLinks}
          href={getRelativeLocaleUrl(locale, "/")}
        />

        <NavTabs tabs={tabs} />

        <main class={className} data-testid="main-content">
          <slot />
        </main>

        <Footer locale={locale} />
      </div>
    </div>
  </body>
</html>
